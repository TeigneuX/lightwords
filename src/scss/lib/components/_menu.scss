/* MENU */

/////////////////////////////////////////////////////////////////////////////
// COMMON STYLES

.divider {
  margin-bottom: $gutter-quarter;
  height: 0.2rem;
  background-color: $navbar-btn-bg-hover;
}


@mixin dropdown() {
  position: relative;
  transition: all 0.25s ease;
  flex-wrap: nowrap;

  .dropdown-menu {
    background-color: $header-color-bg;
    position: absolute;
    bottom: 0;
    left: 0;
    width: 50vw;

    // max-height: calc(100vh - 8rem);
    // overflow-y: auto;

    @include bp($expanded) {
      // max-height: calc(100vh - 19rem);
      width: 25vw;
    }
    padding-top: $gutter-quarter;

    &.dropdown-menu--right {
      left: auto;
      right: 0;
    }

    @include shadow(1);
    transform: scale3d(1, 0, 1) translateY(100%);
    transform-origin: 50% 0 0;
    opacity: 0;
    transition: all 0.5s $ease-bump;
    z-index: +10;

    > .menu-item {
      margin: $gutter-quarter;
      margin-top: 0;
    }

    &.active {
      opacity: 1;
      transform: scale3d(1, 1, 1) translateY(100%);
    }

    .dropdown-menu & {
      overflow: hidden;
    }
  }

  &.active {
    @include shadow(1);
    margin-bottom: 0;
  }
}

// MENUS

.menu-buttons {
  @include reset-list;
  margin-bottom: 0;
  display: flex;
}

// ITEM LINK DEFAULT STYLES

.menu-item-link {
  display: block;
  min-height: $navbar-btn-size;
  @include h-padding($gutter-half);
  line-height: 1; // In case of multi-line

  color: $navbar-btn-color;
  background-color: $navbar-btn-bg;
  // Debug
  // background: $gray-lightest;

  // Flex vertical center
  display: flex;
  align-items: center;

  transition: all 0.25s;

  > .fa,
  > .icon {
    
    & + * {
      margin-left: $gutter-quarter;
    }
  }

  em {
    font-size: $font-size-small;
  }

  // Active item
  .current-menu-item & {
      color: $color-primary;
      font-weight: $font-weight-semibold;
  }
}

// MENU ITEM

.menu-item {

  // Active items (default)
  &:not(.menu-item--passive) {

    > .menu-item-link {
      cursor: pointer;

      &:hover,
      &:active,
      &:focus {
        color: $navbar-btn-color-hover;
        background-color: $navbar-btn-bg-hover;
      }
    }
  }

  &.menu-item--button {
    margin-left: $gutter-quarter;
    
    > .dropdown-toggle {
      margin-left: 0;
    }
    
    > .menu-item-link {
      @include h-padding($gutter-quarter);
      border: 0;
      min-width: $navbar-btn-size;
      transition: color 0.25s;
      // Bring toggle btns back to foreground (in case of overlay/offscreen panel)
      position: relative;
      z-index: +1;

      &:focus {
        outline: none;
        background-color: $navbar-btn-bg-hover;
      }
    }

    // Ugly hamburger exception
    &.menu-item--hamburger {
      > .menu-item-link {
        @include h-padding(($navbar-btn-size - $hamburger-height) / 2);
      }
    }
  }

  // Highlighted item
  &.highlight {
    .site-header & {

      background-color: $color-primary;

      > .menu-item-link {
        color: white;
      }
    }
  }

  // Dropdown
  &.menu-item--dropdown {
    display: flex;
    flex-wrap: wrap;

    .menu-item-link:first-child {
      flex-grow: 1;
    }

    &.menu-item--dropdown-mobile {
      @include dropdown();
    }
  }
}

.dropdown-menu {
  // reset lists
  @include reset-list();
}

.dropdown-toggle {
  margin-left: $gutter-eighth;

  > .caret {
    @include triangle('bottom', $caret-color, $caret-size);
    transition: all 0.5s $ease-bump;
  }

  &.active {
    > .caret {
      transform: rotateZ(180deg);
    }
  }
}

/////////////////////////////////////////////////////////////////////////////
// MOBILE MENU

// Pain in the ass to reset mobile navbar styles on larger screens
// So for once, we allow MOBILE ONLY styles max-width @mq here!
@include bp($expanded, true) {
  //No secondary menu on mobile (hidden and merged into primary one)
  .menu-primary {
    @include v-padding($gutter-half);
    @include h-padding($gutter-quarter);

    .menu-item {
      // Space between items when stacked
      margin-bottom: $gutter-quarter;
    }
  }

  // Sub-menus

  .menu-item--dropdown {

    .dropdown-menu {
      margin-top: $gutter-quarter;
      flex-basis: 100%;
      // TODO: animate hide/show
      display: none;

      &.active {
        display: block;
      }

      .menu-item {
        &:last-child {
          margin-bottom: 0;
        }
      }
    }
  }

  // Nested dropdowns indentation

  .dropdown-menu {

    // First level
    .menu-primary & {

      .menu-item {
        > .menu-item-link:first-child {
          padding-left: $gutter-half + $width-nested-dropdown-indentation;
        }
      }
    }

    // Second (and other) level
    .dropdown-menu & {
      .menu-primary & {
        .menu-item {
          > .menu-item-link:first-child {
            padding-left: $gutter-half + ($width-nested-dropdown-indentation * 2);
          }
        }
      }
    }
  }

}

/////////////////////////////////////////////////////////////////////////////
//DESKTOP MENU

@include bp($expanded) {
  .menu-primary,
  .menu-secondary,
  .menu-buttons {
    .menu-item {
      margin-left: $gutter-quarter;

      &.hidden-expanded {
        display: none; // Needed for submenus with flex display
      }

      // Hide and show dropdown submenu
      &.menu-item--dropdown {
        @include dropdown();
      }
    }
  }
}
