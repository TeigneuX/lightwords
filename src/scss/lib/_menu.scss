/* MENU */

$caret-size: $font-size-base / 3;
$caret-color: $text-color-base;

/////////////////////////////////////////////////////////////////////////////
// COMMON STYLES

.menu-primary,
.menu-secondary {

  .menu-item {

    > .menu-item-link {
      // Debug
      // background: $gray-lightest;
      color: $gray-darker;
      transition: all 0.25s;

      &:hover,
      &:active,
      &:focus {
        color: $gray-darkest;
        background: rgba(0, 0, 0, 0.125);
      }

      display: block;
      min-height: 4.4rem;
      padding-left: $gutter-half;
      padding-right: $gutter-half;
      cursor: pointer;

      // Flex vertical center
      display: flex;
      align-items: center;
      justify-content: space-between; // For carets on mobile

      // don't catch submenus carret span
      > span:not(.caret) {
        line-height: 1; // In case of multi-line
        padding: $gutter-quarter 0;
      }

      > .caret {
        display: block;
        width: 0;
        height: 0;
        border-style: solid;
        border-width: $caret-size $caret-size 0 $caret-size;
        border-color: $caret-color transparent transparent transparent;
        transition: all 0.5s $ease-bump;
      }
    }

    // Active item
    &.current-menu-item {
      > .menu-item-link {
        color: $color-secondary;
      }
    }

    > .dropdown-menu {
      // reset lists
      @include reset-list();

      .menu-item {
        > .menu-item-link {
          @include bp($expanded, true) {
            padding-left: $gutter;
          }
        }
      }
    }

    &.active {
      > .menu-item-link {
        > .caret {
          transform: rotateZ(180deg);
        }
      }
    }

    &.highlight {
      background-color: $color-primary;

      > .menu-item-link {
        color: white;
      }
    }

    &.dropdown {
      display: flex;
      flex-wrap: wrap;
    }
  }
}

/////////////////////////////////////////////////////////////////////////////
// MOBILE MENU

// Pain in the ass to reset mobile navbar styles on larger screens
// So for once, we allow MOBILE ONLY styles max-width @mq here!
@include bp($expanded, true) {
  //No secondary menu on mobile (hidden and merged into primary one)
  .menu-primary {
    padding-top: $gutter-half;
    padding-left: $gutter-quarter;
    padding-right: $gutter-quarter;

    .menu-item:not(.dropdown),
    .dropdown-toggle {
      // Space between items when stacked
      margin-bottom: $gutter-quarter;
    }
  }
  // Hide and show sub-menus
  .dropdown {
    margin-bottom: $gutter-quarter;

    .menu-item-link:first-child {
      flex-grow: 1;
    }

    .dropdown-toggle {
      margin-left: $gutter-quarter;
      margin-bottom: 0;
    }

    .dropdown-menu {
      margin-top: $gutter-quarter;
      flex-basis: 100%;

      .menu-item:last-child {
        margin-bottom: 0;
      }
    }
  }

  .dropdown-menu {
    display: none;

    .dropdown.active & {
      display: block;
    }
  }
}

/////////////////////////////////////////////////////////////////////////////
//DESKTOP MENU

@include bp($expanded) {
  .menu-primary {
    margin-right: -$gutter-half;
    margin-left: $gutter-half;
  }

  .menu-secondary {
  }

  .menu-primary,
  .menu-secondary {
    .menu-item {
      margin-left: $gutter-quarter;

      // Hide and show dropdown submenu
      &.dropdown {
        position: relative;
        transition: all 0.25s ease;

        .menu-item-link:first-child {
          padding-left: $gutter-quarter;
          padding-right: $gutter-quarter;
        }
    
        .dropdown-toggle {
        }

        .dropdown-menu {
          background-color: $header-color-bg;
          position: absolute;
          // top: $navbar-height-desktop;
          bottom: 0;
          left: 0;
          width: 20vw;
          padding-top: $gutter-quarter;

          display: flex;
          flex-direction: column;
          justify-content: center;
          box-shadow: none;
          @include shadow(1);
          transform: scale3d(1, 0, 1) translateY(100%);
          transform-origin: 50% 0 0;
          opacity: 0;
          transition: all 0.5s $ease-bump;
          overflow: hidden;

          > .menu-item {
            margin: $gutter-quarter;
            margin-top: 0;
          }
        }

        &.active {
          @include shadow(1);
          margin-bottom: 0;
    
          .dropdown-menu {
            opacity: 1;
            transform: scale3d(1, 1, 1) translateY(calc(100% - 0.1rem));
          }
        }
      }
    }
  }
}
